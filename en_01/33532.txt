china ruled sporadically until the battle of talas in tang dynasty