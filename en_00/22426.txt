After a protracted court battle